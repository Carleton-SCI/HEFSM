# Homomorphic Encryption-Based Finite State Machine

This repo provides a proof-of-concept for the design and implementation of a Homomorphically Encrypted Finite State Machine (HEFSM) for matching plaintext data against encrypted rules and producing encrypted results. The design and implementation details are available in:

*Mahmoud Sayed and Mostafa Taha, Evaluation of Encrypted Matching Criteria using Homomorphic Encryption-Based FSM, Journal of Cryptographic Engineering, 2024.*

![System Overview of the interaction between the trusted client and the cloud operator in the context of EFSM](https://github.com/Carleton-SCI/HEFSM/blob/main/system_overview.png)

## Contents

This repo contains two implementations:

1. **EFSMv1**: The first variation of the encrypted FSM provides a methodology for implementing any regular expression as an encrypted finite state machine, offering flexibility at the cost of less security compared to the other variant.  
2. **EFSMv2**: EFSMv2 provides stricter security compared to EFSMv1 at the expense of more restrictions on the regular expression (accepted strings must be of a pre-defined length at compilation time, so regexes that accept strings of arbitrary lengths cannot be implemented, except in the case of `.*` (wildcard Kleene star) at the beginning and the end of the expression).

## Prerequisites

EFSMv1-2 have some dependencies:

1. Python 3  
2. pip â€“ Install `pip` if you don't have it already (EFSMv1)  
3. TFHE-io Homomorphic Encryption library (EFSMv1-2)  
4. Greenery library (EFSMv1)  
5. logicmin library (EFSMv1)  

Below are some guidelines for these prerequisites:

### TFHE-io Library

While EFSMv1-2 are HE library-independent (they can be implemented with any HE library that supports logic operations), the provided proof-of-concept is built upon the TFHE-io library. Please follow the steps outlined in: <https://tfhe.github.io/tfhe/> to install the TFHE-io library.

### Greenery Library

EFSMv1 uses some of the mechanics in Greenery to convert a regular expression into a minimized finite state machine, which is then implemented by the HE library. Our implementation uses a specific version of Greenery; **DO NOT INSTALL THE LATEST VERSION**. Instead, install version **3.3.1**, which can be done by:

```bash
pip install greenery==3.3.1
```

### logicmin library
LogicMin is a Python package that minimizes boolean functions using the tabular method of minimization (Quine-McCluskey). We use it to generate minimized Sum-Of-Product expressions for the FSM's state table generated by Greenery. The version we tested is 0.4.0, which can be installed by:
```bash
pip install logicmin==0.4.0
```

## Testing Procedure
After installing the prerequisites and cloning the repo, open the folder of the variation you'd like to test (EFSMv1, EFSMv2) and follow the instructions found there.


